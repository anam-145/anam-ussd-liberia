<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USSD Simulator - UNDP Wallet (*123#)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); */
            /* background: #0B3B5A; */
            background: linear-gradient(180deg, #0B3B5A 0%, #0E4A78 40%, #146A9C 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .simulator-container {
            display: flex;
            gap: 30px;
            max-width: 1200px;
            width: 100%;
        }

        .phone-container {
            background: #1a1a1a;
            border-radius: 30px;
            padding: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 350px;
        }

        .phone-screen {
            background: #f5f5f5;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .phone-header {
            background: #2c3e50;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
        }

        .phone-display {
            background: #fff;
            min-height: 400px;
            max-height: 400px;
            overflow-y: auto;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .phone-input-area {
            background: #ecf0f1;
            padding: 15px;
            border-top: 1px solid #bdc3c7;
        }

        .phone-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #3498db;
            border-radius: 5px;
            font-size: 16px;
            font-family: 'Courier New', monospace;
        }

        .phone-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-send {
            background: #27ae60;
            color: white;
        }

        .btn-send:hover {
            background: #229954;
        }

        .btn-cancel {
            background: #e74c3c;
            color: white;
        }

        .btn-cancel:hover {
            background: #c0392b;
        }

        .info-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            flex: 1;
            max-height: 600px;
            overflow-y: auto;
        }

        .info-panel h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .info-section {
            margin-bottom: 20px;
        }

        .info-section h3 {
            color: #34495e;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .info-section p {
            color: #7f8c8d;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .status-new {
            background: #f39c12;
            color: white;
        }

        .status-active {
            background: #27ae60;
            color: white;
        }

        .scenario-selector {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .scenario-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .scenario-selector select {
            width: 100%;
            padding: 10px;
            border: 2px solid #3498db;
            border-radius: 5px;
            font-size: 14px;
        }

        .log-entry {
            background: #f8f9fa;
            padding: 10px;
            margin-bottom: 8px;
            border-left: 3px solid #3498db;
            border-radius: 3px;
            font-size: 12px;
        }

        .log-entry strong {
            color: #2c3e50;
        }

        .dial-button {
            background: #3498db;
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .dial-button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="simulator-container">
        <!-- Phone Simulator -->
        <div class="phone-container">
            <div class="phone-screen">
                <div class="phone-header">
                    Feature Phone Display
                </div>
                <div class="phone-display" id="display">
Welcome to USSD Simulator

Click "Dial *123#" to start
                </div>
                <div class="phone-input-area">
                    <input type="text"
                           class="phone-input"
                           id="userInput"
                           placeholder="Enter your input here..."
                           disabled>
                    <div class="phone-buttons">
                        <button class="btn btn-send" id="sendBtn" disabled>Send</button>
                        <button class="btn btn-cancel" id="cancelBtn" disabled>Cancel</button>
                    </div>
                </div>
            </div>
            <div class="dial-button" id="dialBtn">
                Dial *123#
            </div>
        </div>

        <!-- Info Panel -->
        <div class="info-panel">
            <h2>USSD Service Simulator</h2>

            <div class="scenario-selector">
                <label for="scenarioSelect">Select User Scenario:</label>
                <select id="scenarioSelect">
                    <option value="new">New User (First Time - PIN Setup)</option>
                    <option value="existing">Existing User (Already Activated)</option>
                </select>
            </div>

            <div class="info-section">
                <h3>Current Session Status</h3>
                <span class="status-badge" id="statusBadge">Not Started</span>
                <p><strong>Phone Number:</strong> <span id="phoneNumber">+231 777 123 456</span></p>
                <p><strong>User Status:</strong> <span id="userStatus">-</span></p>
                <p><strong>Current State:</strong> <span id="currentState">-</span></p>
            </div>

            <div class="info-section">
                <h3>Session Log</h3>
                <div id="sessionLog"></div>
            </div>

            <div class="info-section">
                <h3>Available Features</h3>
                <p>1. Check Balance - View wallet balance</p>
                <p>2. Transfer - Send funds to another user</p>
                <p>3. Exit - End USSD session</p>
            </div>

            <div class="info-section">
                <h3>Test Data</h3>
                <p><strong>Test PIN:</strong> 1234</p>
                <p><strong>Test Recipient Phone:</strong> +231 777 999 888</p>
                <p><strong>Test Amount:</strong> 10</p>
                <p><strong>Mock Balance:</strong> 100 USDC</p>
            </div>
        </div>
    </div>

    <script>
        // Session state management
        let session = {
            sessionId: null,
            phoneNumber: '+231777123456',
            state: 'IDLE',
            tempData: {},
            isNewUser: true
        };

        // Mock user data
        const mockUsers = {
            new: {
                status: 'PENDING_USSD',
                hasWallet: false,
                balance: 0
            },
            existing: {
                status: 'ACTIVE',
                hasWallet: true,
                walletAddress: '0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb',
                balance: 100,
                pin: '1234'
            }
        };

        // UI Elements
        const display = document.getElementById('display');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const dialBtn = document.getElementById('dialBtn');
        const scenarioSelect = document.getElementById('scenarioSelect');
        const statusBadge = document.getElementById('statusBadge');
        const userStatus = document.getElementById('userStatus');
        const currentState = document.getElementById('currentState');
        const sessionLog = document.getElementById('sessionLog');

        // Menu texts
        const menus = {
            welcome_new: "Welcome to UNDP Wallet.\nThis is your first time.\n\nPlease set your 4-digit PIN:",
            welcome_back: "Welcome to UNDP Wallet.\n\nPlease enter your PIN:",
            main_menu: "UNDP Wallet\n\n1. Check Balance\n2. Transfer\n3. Exit\n\nSelect option:",
            enter_pin: "Enter your 4-digit PIN:",
            invalid_pin: "Invalid PIN.\nSession ended.",
            enter_recipient: "Enter recipient:\n(Phone number or address)",
            enter_amount: "Enter amount to send:",
            confirm_transfer: "Send {amount} to {recipient}?\n\n1. Yes\n2. No",
            transfer_success: "Transfer successful!\nTxHash: {txHash}\n\nPress any key for menu",
            balance_display: "Your Balance:\n{balance} USDC\n\nPress any key for menu",
            account_activated: "Account Activated!\n\nWallet: {address}\n\nPress any key for menu",
            session_ended: "Thank you for using UNDP Wallet.\nGoodbye!"
        };

        // Event Listeners
        dialBtn.addEventListener('click', initSession);
        sendBtn.addEventListener('click', handleInput);
        cancelBtn.addEventListener('click', endSession);
        scenarioSelect.addEventListener('change', resetSimulator);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleInput();
        });

        function initSession() {
            session.sessionId = 'sess_' + Math.random().toString(36).substr(2, 9);
            session.isNewUser = scenarioSelect.value === 'new';

            if (session.isNewUser) {
                session.state = 'AWAITING_PIN_SETUP';
                updateDisplay(menus.welcome_new);
                updateStatus('New User', 'PENDING_USSD', 'AWAITING_PIN_SETUP');
                logAction('Session started', 'New user detected. Prompting PIN setup.');
            } else {
                session.state = 'AWAITING_PIN';
                updateDisplay(menus.welcome_back);
                updateStatus('Existing User', 'ACTIVE', 'AWAITING_PIN');
                logAction('Session started', 'Existing user detected. Prompting PIN.');
            }

            enableInput();
            dialBtn.style.display = 'none';
        }

        function handleInput() {
            const input = userInput.value.trim();
            if (!input) return;

            logAction('User input', input);
            userInput.value = '';

            processInput(input);
        }

        function processInput(input) {
            switch (session.state) {
                case 'AWAITING_PIN_SETUP':
                    handlePinSetup(input);
                    break;
                case 'AWAITING_PIN':
                    handlePinVerification(input);
                    break;
                case 'MAIN_MENU':
                    handleMainMenu(input);
                    break;
                case 'AWAITING_PIN_BALANCE':
                    handlePinForBalance(input);
                    break;
                case 'AWAITING_PIN_TRANSFER':
                    handlePinForTransfer(input);
                    break;
                case 'AWAITING_RECIPIENT':
                    handleRecipient(input);
                    break;
                case 'AWAITING_AMOUNT':
                    handleAmount(input);
                    break;
                case 'AWAITING_CONFIRM':
                    handleConfirmation(input);
                    break;
                case 'SHOWING_RESULT':
                    showMainMenu();
                    break;
            }
        }

        function handlePinSetup(pin) {
            if (pin.length !== 4 || !/^\d+$/.test(pin)) {
                updateDisplay("PIN must be 4 digits.\nPlease try again:");
                return;
            }

            session.tempData.pin = pin;
            logAction('PIN Setup', 'PIN set successfully. Activating account...');

            // Simulate account activation
            setTimeout(() => {
                const mockAddress = '0x' + Math.random().toString(16).substr(2, 40);
                const message = menus.account_activated.replace('{address}', mockAddress);
                updateDisplay(message);
                updateStatus('Activated', 'ACTIVE', 'SHOWING_RESULT');
                logAction('Account Activated', `Wallet created: ${mockAddress}`);
                session.state = 'SHOWING_RESULT';
            }, 1000);
        }

        function handlePinVerification(pin) {
            if (pin === mockUsers.existing.pin) {
                logAction('PIN Verified', 'Access granted.');
                showMainMenu();
            } else {
                updateDisplay(menus.invalid_pin);
                updateStatus('Failed', 'PIN Incorrect', 'SESSION_ENDED');
                logAction('PIN Failed', 'Invalid PIN entered. Session ended.');
                disableInput();
                setTimeout(resetSimulator, 3000);
            }
        }

        function showMainMenu() {
            session.state = 'MAIN_MENU';
            updateDisplay(menus.main_menu);
            updateStatus('Authenticated', 'ACTIVE', 'MAIN_MENU');
        }

        function handleMainMenu(choice) {
            switch (choice) {
                case '1':
                    session.state = 'AWAITING_PIN_BALANCE';
                    updateDisplay(menus.enter_pin);
                    updateStatus('Authenticated', 'ACTIVE', 'AWAITING_PIN_BALANCE');
                    logAction('Menu Selection', 'User selected: Check Balance');
                    break;
                case '2':
                    session.state = 'AWAITING_PIN_TRANSFER';
                    updateDisplay(menus.enter_pin);
                    updateStatus('Authenticated', 'ACTIVE', 'AWAITING_PIN_TRANSFER');
                    logAction('Menu Selection', 'User selected: Transfer');
                    break;
                case '3':
                    endSession();
                    break;
                default:
                    updateDisplay("Invalid option.\n\n" + menus.main_menu);
            }
        }

        function handlePinForBalance(pin) {
            if (pin === session.tempData.pin || pin === mockUsers.existing.pin) {
                logAction('Balance Check', 'Fetching balance...');
                const balance = mockUsers.existing.balance;
                const message = menus.balance_display.replace('{balance}', balance);
                updateDisplay(message);
                session.state = 'SHOWING_RESULT';
                updateStatus('Authenticated', 'ACTIVE', 'SHOWING_RESULT');
            } else {
                updateDisplay(menus.invalid_pin);
                setTimeout(resetSimulator, 2000);
            }
        }

        function handlePinForTransfer(pin) {
            if (pin === session.tempData.pin || pin === mockUsers.existing.pin) {
                session.state = 'AWAITING_RECIPIENT';
                updateDisplay(menus.enter_recipient);
                updateStatus('Authenticated', 'ACTIVE', 'AWAITING_RECIPIENT');
                logAction('Transfer Started', 'PIN verified. Requesting recipient.');
            } else {
                updateDisplay(menus.invalid_pin);
                setTimeout(resetSimulator, 2000);
            }
        }

        function handleRecipient(recipient) {
            session.tempData.recipient = recipient;
            session.state = 'AWAITING_AMOUNT';
            updateDisplay(menus.enter_amount);
            updateStatus('Authenticated', 'ACTIVE', 'AWAITING_AMOUNT');
            logAction('Recipient Set', `Recipient: ${recipient}`);
        }

        function handleAmount(amount) {
            if (isNaN(amount) || parseFloat(amount) <= 0) {
                updateDisplay("Invalid amount.\n" + menus.enter_amount);
                return;
            }

            session.tempData.amount = amount;
            session.state = 'AWAITING_CONFIRM';
            const message = menus.confirm_transfer
                .replace('{amount}', amount)
                .replace('{recipient}', session.tempData.recipient);
            updateDisplay(message);
            updateStatus('Authenticated', 'ACTIVE', 'AWAITING_CONFIRM');
            logAction('Amount Set', `Amount: ${amount} USDC`);
        }

        function handleConfirmation(choice) {
            if (choice === '1') {
                logAction('Transfer Confirmed', 'Processing transaction...');
                const txHash = '0x' + Math.random().toString(16).substr(2, 64);
                const message = menus.transfer_success.replace('{txHash}', txHash);
                updateDisplay(message);
                session.state = 'SHOWING_RESULT';
                updateStatus('Authenticated', 'ACTIVE', 'SHOWING_RESULT');
                logAction('Transfer Success', `TxHash: ${txHash}`);
            } else {
                logAction('Transfer Cancelled', 'User cancelled transaction.');
                showMainMenu();
            }
        }

        function endSession() {
            updateDisplay(menus.session_ended);
            updateStatus('Ended', '-', 'SESSION_ENDED');
            logAction('Session Ended', 'User exited.');
            disableInput();
            setTimeout(resetSimulator, 3000);
        }

        function updateDisplay(text) {
            display.textContent = text;
        }

        function updateStatus(badge, status, state) {
            statusBadge.textContent = badge;
            statusBadge.className = 'status-badge ' +
                (badge.includes('New') || badge.includes('Failed') ? 'status-new' : 'status-active');
            userStatus.textContent = status;
            currentState.textContent = state;
        }

        function logAction(action, details) {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            const timestamp = new Date().toLocaleTimeString();
            logEntry.innerHTML = `<strong>${timestamp} - ${action}:</strong> ${details}`;
            sessionLog.insertBefore(logEntry, sessionLog.firstChild);
        }

        function enableInput() {
            userInput.disabled = false;
            sendBtn.disabled = false;
            cancelBtn.disabled = false;
            userInput.focus();
        }

        function disableInput() {
            userInput.disabled = true;
            sendBtn.disabled = true;
            cancelBtn.disabled = true;
        }

        function resetSimulator() {
            session = {
                sessionId: null,
                phoneNumber: '+231777123456',
                state: 'IDLE',
                tempData: {},
                isNewUser: true
            };

            updateDisplay("Welcome to USSD Simulator\n\nClick \"Dial *123#\" to start");
            updateStatus('Not Started', '-', '-');
            sessionLog.innerHTML = '';
            disableInput();
            dialBtn.style.display = 'block';
        }
    </script>
</body>
</html>
